<!DOCTYPE html><html lang="en" ><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="/assets/css/syntax.css" rel="stylesheet"><title>MySQL Exact Row Count For All The Tables | The Data Guy</title><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="MySQL Exact Row Count For All The Tables" /><meta name="author" content="Bhuvanesh" /><meta property="og:locale" content="en_US" /><meta name="description" content="Use this stored procedure to get the exact row count of all the tables in mysql. Get the table names using cursor and run select count." /><meta property="og:description" content="Use this stored procedure to get the exact row count of all the tables in mysql. Get the table names using cursor and run select count." /><meta property="og:site_name" content="The Data Guy" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-02-25T11:35:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="MySQL Exact Row Count For All The Tables" /><meta name="twitter:site" content="@bhuvithedataguy" /><meta name="twitter:creator" content="@https://twitter.com/BhuviTheDataGuy" /> <script type="application/ld+json"> {"dateModified":"2019-02-25T11:35:00+00:00","datePublished":"2019-02-25T11:35:00+00:00","url":"/2019/02/25/mysql-exact-row-count-for-all-the-tables","mainEntityOfPage":{"@type":"WebPage","@id":"/2019/02/25/mysql-exact-row-count-for-all-the-tables"},"@type":"BlogPosting","author":{"@type":"Person","name":"Bhuvanesh"},"description":"Use this stored procedure to get the exact row count of all the tables in mysql. Get the table names using cursor and run select count.","headline":"MySQL Exact Row Count For All The Tables","@context":"https://schema.org"}</script><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.7;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#ecedee}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}#share-bar{font-size:20px}#share-bar h4{margin-bottom:10px;font-weight:500}.share-button{margin:0px;margin-bottom:10px;margin-right:3px;border:1px solid #D3D6D2;padding:5px 10px 5px 10px}.share-button:hover{opacity:1;color:#ffffff}.fa-facebook-official{color:#3b5998}.fa-facebook-official:hover{background-color:#3b5998}.fa-twitter{color:#55acee}.fa-twitter:hover{background-color:#55acee}.fa-google-plus{color:#dd4b39}.fa-google-plus:hover{background-color:#dd4b39}.fa-pinterest-p{color:#cb2027}.fa-pinterest-p:hover{background-color:#cb2027}.fa-tumblr{color:#32506d}.fa-tumblr:hover{background-color:#32506d}.fa-reddit-alien{color:#ff4500}.fa-reddit-alien:hover{background-color:#ff4500}.fa-linkedin{color:#007bb5}.fa-linkedin:hover{background-color:#007bb5}.fa-envelope{color:#444444}.fa-envelope:hover{background-color:#444444}</style></head><body><main role="main"><header role="banner"><h1 class="logo">The Data Guy</h1><div class="page-author h-card p-author"><img src="/assets/circle-cropped.png" class="author-avatar u-photo" alt="Bhuvanesh"></div><nav role="navigation"><ul><li><a href="/" >Home</a></li><li><a href="/posts/" >Posts</a></li><li><a href="/categories/" >Categories</a></li><li><a href="/tags/" >Tags</a></li><li><a href="https://medium.com/@bhuvithedataguy" >Medium Blog</a></li><li><a href="/search" >Search Here</a></li></ul></nav></header><section class="post"><h2>MySQL Exact Row Count For All The Tables</h2><p><img src="/uploads/MySQL Exact Row Count For All The Tables.jpg" alt="MySQL Exact Row Count For All The Tables" title="MySQL Exact Row Count For All The Tables" /></p><p>Getting the row count from mysql tables are not a big deal and even there is no need for a blog for this. Simply go and query the <code class="language-html highlighter-rouge">INFORMATION</code><code class="language-html highlighter-rouge">_SCHEMA</code> <em>and get the row count for the tables. But this is not your actual row counts. It’ll show the row count of the tables during the last statistics update. So if you want to track your tables growth then you should do</em> <code class="language-html highlighter-rouge">select count(*) from table_name</code> for all the tables and insert the results to somewhere. There are a lot of ways available. Im just make this as a blog post. So others can benefit from it.</p><h2 id="row-count---from-stored-procedure">Row Count - From Stored Procedure:</h2><p>We’ll get the list of table names from the <code class="language-html highlighter-rouge">information_schema</code> and use <code class="language-html highlighter-rouge">cursor</code> to run <code class="language-html highlighter-rouge">select count(*)</code> on that table and save the row count value to a table.</p><p>In this example, Im going to collect the row count of the tables from the database called <code class="language-html highlighter-rouge">prod_db</code>. And this procedure and tracking table will be saved on the database called <code class="language-html highlighter-rouge">dbadmin</code>.</p><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="n">use</span> <span class="n">dbadmin</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">table_growth</span> <span class="p">(</span>  
<span class="n">id</span> <span class="nb">INT</span> <span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span>  
<span class="p">,</span><span class="nb">timestamp</span> <span class="nb">DATETIME</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span>  
<span class="p">,</span><span class="k">table_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span>  
<span class="p">,</span><span class="k">rows</span> <span class="nb">INT</span> <span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span>  
<span class="p">,</span><span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>  
<span class="p">);</span>

<span class="k">delimiter</span> <span class="o">//</span>  
<span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">rows_growth</span><span class="p">()</span>  
<span class="k">BEGIN</span>  
<span class="k">DECLARE</span> <span class="k">start</span> <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">;</span>  
<span class="k">DECLARE</span> <span class="n">t_name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>  
<span class="k">DEClARE</span> <span class="n">table_names</span> <span class="k">CURSOR</span> <span class="k">FOR</span>  
    	<span class="k">SELECT</span> <span class="k">table_name</span> <span class="k">FROM</span> <span class="n">INFORMATION_SCHEMA</span><span class="p">.</span><span class="n">TABLES</span> <span class="k">WHERE</span> <span class="n">TABLE_SCHEMA</span><span class="o">=</span><span class="s1">'prod_db'</span><span class="p">;</span>  
<span class="k">DECLARE</span> <span class="k">CONTINUE</span> <span class="k">HANDLER</span>  
        <span class="k">FOR</span> <span class="k">NOT</span> <span class="k">FOUND</span> <span class="k">SET</span> <span class="k">start</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>  
<span class="k">OPEN</span> <span class="n">table_names</span><span class="p">;</span>  
<span class="n">get_tablename</span><span class="p">:</span> <span class="k">table_name</span>  
<span class="k">FETCH</span> <span class="n">table_names</span> <span class="k">INTO</span> <span class="n">t_name</span><span class="p">;</span>  
<span class="k">SET</span> <span class="o">@</span><span class="n">query</span> <span class="o">=</span><span class="n">CONCAT</span><span class="p">(</span><span class="s1">'insert into table_growth (table_name, rows)  select "'</span><span class="p">,</span><span class="n">t_name</span><span class="p">,</span><span class="s1">'" as tablename '</span><span class="p">,</span> <span class="s1">','</span><span class="p">,</span> <span class="s1">'count(*) from prod_db.'</span><span class="p">,</span> <span class="n">t_name</span><span class="p">);</span>  
<span class="k">select</span> <span class="o">@</span><span class="n">query</span><span class="p">;</span>  
<span class="k">PREPARE</span> <span class="n">insert_stmt</span> <span class="k">FROM</span> <span class="o">@</span><span class="n">query</span><span class="p">;</span>  
<span class="k">EXECUTE</span> <span class="n">insert_stmt</span><span class="p">;</span>  
<span class="n">IF</span> <span class="k">start</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">THEN</span>  
<span class="n">LEAVE</span> <span class="n">get_tablename</span><span class="p">;</span>  
<span class="k">END</span> <span class="n">IF</span><span class="p">;</span>  
<span class="k">END</span> <span class="k">table_name</span> <span class="n">get_tablename</span><span class="p">;</span>  
<span class="k">CLOSE</span> <span class="n">table_names</span><span class="p">;</span>  
<span class="k">END</span><span class="o">//</span>  
<span class="k">delimiter</span> <span class="p">;</span></code></pre></figure><h2 id="row-count---from-shell-script">Row Count - From Shell Script</h2><figure class="highlight"><pre><code class="language-shell" data-lang="shell">mysql  <span class="nt">-h</span> IP_ADDRESS <span class="nt">-usqladmin</span>  <span class="nt">-p</span><span class="s1">'password!'</span> Foodie  <span class="nt">-N</span> <span class="nt">-e</span> <span class="s2">"SELECT table_name FROM INFORMATION_SCHEMA.tables where table_schema='Foodie';"</span> | <span class="k">while </span><span class="nb">read</span> <span class="nt">-r</span> table_name  
<span class="k">do  
</span><span class="nv">count</span><span class="o">=</span><span class="si">$(</span>mysql <span class="nt">-h</span> IP_ADDRESS <span class="nt">-usqladmin</span>  <span class="nt">-p</span><span class="s1">'password'</span> Foodie <span class="nt">-N</span> <span class="nt">-e</span> <span class="s2">"SELECT COUNT(*) FROM </span><span class="nv">$table_name</span><span class="s2">;"</span><span class="si">)</span>  
mysql  <span class="nt">-h</span> IP_ADDRESS <span class="nt">-usqladmin</span>  <span class="nt">-p</span><span class="s1">'pass!'</span>  dbadmin <span class="nt">-e</span> <span class="s2">"INSERT INTO table_growth (table_name, rows)  VALUES ('</span><span class="nv">$table_name</span><span class="s2">',</span><span class="nv">$count</span><span class="s2">);"</span>  
<span class="k">done</span></code></pre></figure><p>If your tables are having a huge amount of data and running with one or two read replica, then use replica’s IP address for doing the <code class="language-html highlighter-rouge">select count(*)</code>.</p><span class="meta"><time datetime="2019-02-25T11:35:00+00:00">February 25, 2019</time> &middot; <a href="/tags/#mysql">mysql</a>, <a href="/tags/# shellscript"> shellscript</a></span><hr> <!--<span class="meta"><time datetime="2019-02-25T11:35:00+00:00">February 25, 2019</time> &middot; <a class="post" href="/tag/mysql">mysql</a>, <a class="post" href="/tag/ shellscript"> shellscript</a></span> --></section></main></body></html>
