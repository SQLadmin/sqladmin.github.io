<!DOCTYPE html><html lang="en" ><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="/assets/css/syntax.css" rel="stylesheet"><title>Create Aurora Read Replica With AWS CLI/Lambda Python | The Data Guy</title><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="Create Aurora Read Replica With AWS CLI/Lambda Python" /><meta name="author" content="Bhuvanesh" /><meta property="og:locale" content="en_US" /><meta name="description" content="This blog will help you to automate Create Aurora Read Replica With AWS CLI/Lambda Python. You can use this for a scaleable solution." /><meta property="og:description" content="This blog will help you to automate Create Aurora Read Replica With AWS CLI/Lambda Python. You can use this for a scaleable solution." /><meta property="og:site_name" content="The Data Guy" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-01-25T19:09:11+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Create Aurora Read Replica With AWS CLI/Lambda Python" /><meta name="twitter:site" content="@bhuvithedataguy" /><meta name="twitter:creator" content="@https://twitter.com/BhuviTheDataGuy" /> <script type="application/ld+json"> {"dateModified":"2019-01-25T19:09:11+00:00","datePublished":"2019-01-25T19:09:11+00:00","url":"/2019/01/25/create-aurora-read-replica-aws-cli-lambda-python","mainEntityOfPage":{"@type":"WebPage","@id":"/2019/01/25/create-aurora-read-replica-aws-cli-lambda-python"},"@type":"BlogPosting","author":{"@type":"Person","name":"Bhuvanesh"},"description":"This blog will help you to automate Create Aurora Read Replica With AWS CLI/Lambda Python. You can use this for a scaleable solution.","headline":"Create Aurora Read Replica With AWS CLI/Lambda Python","@context":"https://schema.org"}</script><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.7;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#ecedee}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}#share-bar{font-size:20px}#share-bar h4{margin-bottom:10px;font-weight:500}.share-button{margin:0px;margin-bottom:10px;margin-right:3px;border:1px solid #D3D6D2;padding:5px 10px 5px 10px}.share-button:hover{opacity:1;color:#ffffff}.fa-facebook-official{color:#3b5998}.fa-facebook-official:hover{background-color:#3b5998}.fa-twitter{color:#55acee}.fa-twitter:hover{background-color:#55acee}.fa-google-plus{color:#dd4b39}.fa-google-plus:hover{background-color:#dd4b39}.fa-pinterest-p{color:#cb2027}.fa-pinterest-p:hover{background-color:#cb2027}.fa-tumblr{color:#32506d}.fa-tumblr:hover{background-color:#32506d}.fa-reddit-alien{color:#ff4500}.fa-reddit-alien:hover{background-color:#ff4500}.fa-linkedin{color:#007bb5}.fa-linkedin:hover{background-color:#007bb5}.fa-envelope{color:#444444}.fa-envelope:hover{background-color:#444444}</style></head><body><main role="main"><header role="banner"><h1 class="logo">The Data Guy</h1><div class="page-author h-card p-author"><img src="/assets/circle-cropped.png" class="author-avatar u-photo" alt="Bhuvanesh"></div><nav role="navigation"><ul><li><a href="/" >Home</a></li><li><a href="/posts/" >Posts</a></li><li><a href="/categories/" >Categories</a></li><li><a href="/tags/" >Tags</a></li><li><a href="https://medium.com/@bhuvithedataguy" >Medium Blog</a></li><li><a href="/search" >Search Here</a></li></ul></nav></header><section class="post"><h2>Create Aurora Read Replica With AWS CLI/Lambda Python</h2><p><img src="https://thedataguy.in/assets/Create-Aurora-Read-Replica-With-AWS-CLI-Lambda-Python.jpg" alt="Create Aurora Read Replica With AWS CLI-Lambda Python" title="Create Aurora Read Replica With AWS CLI-Lambda Python" /></p><p>Today I was working for a scaleable solution in Aurora. Im going to publish that blog post soon in <a href="https://medium.com/searce">Searce</a> Blog. As a part of this solution, I want to create Aurora read replicas programmatically. So we have done the create aurora read replica with AWS CLI and Lambda with Python. If you refer the AWS Doc, they mentioned there is no separate module for creating Aurora Read replica in boto3 or cli. Instead we can use <a href="https://docs.aws.amazon.com/cli/latest/reference/rds/create-db-instance.html"><em>create-db-instance</em></a>. Many people may confused with this term. This blog will help them to create aurora read replicas using AWS CLI and Lambda.</p><h2 id="required-permission">Required Permission:</h2><p>If you are running this code via lambda then you can use the below policy.</p><ul><li>Lambda - Create a new role for lambda and attach inline policy</li><li>EC2 Role - Create a new EC2 role and attach this policy and attach this Role to EC2.</li><li>IAM User - If you are manually use IAM credentials for AWS CLI, attach the below policy to the IAM user.</li></ul><figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">    
    </span><span class="p">{</span><span class="w">
        </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
                </span><span class="nl">"Sid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"VisualEditor0"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
                </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                    </span><span class="s2">"rds:CreateDBCluster"</span><span class="p">,</span><span class="w">
                    </span><span class="s2">"rds:CreateDBInstance"</span><span class="w">
                </span><span class="p">],</span><span class="w">
                </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span></code></pre></figure><h2 id="create-your-aurora-cluster">Create Your Aurora Cluster:</h2><p>First we need to create an Aurora cluster with 1 node. There are so many references for this. :) I leave this part to you.</p><h3 id="aurora-details">Aurora Details:</h3><ul><li>Cluster Name: bhuvi-aurora-replica-cluster</li><li>Engine: aurora-mysql</li><li>Engine Version: 5.7.12</li><li>DB Parameter Group: default.aurora-mysql5.7</li><li>Publicly accessible: Yes</li><li>Storage Encrypt: No</li></ul><h2 id="aws-cli-command">AWS CLI Command:</h2><figure class="highlight"><pre><code class="language-shell" data-lang="shell">    aws rds create-db-instance <span class="nt">--db-instance-identifier</span> bhuvi-aurora-cli <span class="se">\</span>
     <span class="nt">--db-instance-class</span> db.t2.small <span class="se">\</span>
      <span class="nt">--engine</span> aurora-mysql <span class="se">\</span>
      <span class="nt">--availability-zone</span> us-east-1b <span class="se">\</span>
      <span class="nt">--db-parameter-group-name</span> default.aurora-mysql5.7 <span class="se">\</span>
      <span class="nt">--publicly-accessible</span> <span class="se">\</span>
      <span class="nt">--no-storage-encrypted</span> <span class="se">\</span>
      <span class="nt">--db-cluster-identifier</span> bhuvi-aurora-replica-cluster  <span class="se">\</span>
      <span class="nt">--promotion-tier</span> 15</code></pre></figure><h2 id="lambda-code-in-python">Lambda Code in Python:</h2><figure class="highlight"><pre><code class="language-python" data-lang="python">    <span class="kn">import</span> <span class="nn">time</span>
    <span class="kn">import</span> <span class="nn">boto3</span>
    <span class="kn">import</span> <span class="nn">botocore</span>

    <span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
         <span class="n">rds</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="n">client</span><span class="p">(</span><span class="s">'rds'</span><span class="p">)</span>

         <span class="n">rds</span><span class="p">.</span><span class="n">create_db_instance</span><span class="p">(</span>
            <span class="n">DBParameterGroupName</span><span class="o">=</span><span class="s">'default.aurora-mysql5.7'</span><span class="p">,</span>
          <span class="n">Engine</span><span class="o">=</span><span class="s">'aurora-mysql'</span><span class="p">,</span>
          <span class="n">EngineVersion</span><span class="o">=</span><span class="s">'5.7.12'</span><span class="p">,</span>
          <span class="n">DBClusterIdentifier</span><span class="o">=</span><span class="s">'bhuvi-aurora-replica-cluster'</span><span class="p">,</span>
          <span class="n">AvailabilityZone</span><span class="o">=</span><span class="s">'us-east-1b'</span><span class="p">,</span>
          <span class="n">DBInstanceClass</span><span class="o">=</span><span class="s">'db.t2.small'</span><span class="p">,</span>
          <span class="n">DBInstanceIdentifier</span><span class="o">=</span><span class="s">'bhuvi-aurora-lambda1'</span><span class="p">,</span>
          <span class="n">PubliclyAccessible</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
          <span class="n">StorageEncrypted</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
          <span class="n">PromotionTier</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span></code></pre></figure><span class="meta"><time datetime="2019-01-25T19:09:11+00:00">January 25, 2019</time> &middot; <a href="/tags/#aurora">aurora</a>, <a href="/tags/#aws">aws</a>, <a href="/tags/#cli">cli</a>, <a href="/tags/#lamba">lamba</a>, <a href="/tags/#mysql">mysql</a>, <a href="/tags/#python">python</a>, <a href="/tags/#rds">rds</a></span><hr> <!--<span class="meta"><time datetime="2019-01-25T19:09:11+00:00">January 25, 2019</time> &middot; <a class="post" href="/tag/aurora">aurora</a>, <a class="post" href="/tag/aws">aws</a>, <a class="post" href="/tag/cli">cli</a>, <a class="post" href="/tag/lamba">lamba</a>, <a class="post" href="/tag/mysql">mysql</a>, <a class="post" href="/tag/python">python</a>, <a class="post" href="/tag/rds">rds</a></span> --></section></main></body></html>
