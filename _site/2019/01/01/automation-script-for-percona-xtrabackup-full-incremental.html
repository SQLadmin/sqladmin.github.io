<!DOCTYPE html><html lang="en" ><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="/assets/css/syntax.css" rel="stylesheet"><title>Automation Script For Percona Xtrabackup FULL/Incremental | The Data Guy</title><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="Automation Script For Percona Xtrabackup FULL/Incremental" /><meta name="author" content="Bhuvanesh" /><meta property="og:locale" content="en_US" /><meta name="description" content="Percona xtrabackup support incremental backup. Here we automate percona xtrabackup for full and incremtnal backup using shell script." /><meta property="og:description" content="Percona xtrabackup support incremental backup. Here we automate percona xtrabackup for full and incremtnal backup using shell script." /><meta property="og:site_name" content="The Data Guy" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-01-01T15:33:18+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Automation Script For Percona Xtrabackup FULL/Incremental" /><meta name="twitter:site" content="@bhuvithedataguy" /><meta name="twitter:creator" content="@https://twitter.com/BhuviTheDataGuy" /> <script type="application/ld+json"> {"dateModified":"2019-01-01T15:33:18+00:00","datePublished":"2019-01-01T15:33:18+00:00","url":"/2019/01/01/automation-script-for-percona-xtrabackup-full-incremental","mainEntityOfPage":{"@type":"WebPage","@id":"/2019/01/01/automation-script-for-percona-xtrabackup-full-incremental"},"@type":"BlogPosting","author":{"@type":"Person","name":"Bhuvanesh"},"description":"Percona xtrabackup support incremental backup. Here we automate percona xtrabackup for full and incremtnal backup using shell script.","headline":"Automation Script For Percona Xtrabackup FULL/Incremental","@context":"https://schema.org"}</script><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.7;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#ecedee}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}#share-bar{font-size:20px}#share-bar h4{margin-bottom:10px;font-weight:500}.share-button{margin:0px;margin-bottom:10px;margin-right:3px;border:1px solid #D3D6D2;padding:5px 10px 5px 10px}.share-button:hover{opacity:1;color:#ffffff}.fa-facebook-official{color:#3b5998}.fa-facebook-official:hover{background-color:#3b5998}.fa-twitter{color:#55acee}.fa-twitter:hover{background-color:#55acee}.fa-google-plus{color:#dd4b39}.fa-google-plus:hover{background-color:#dd4b39}.fa-pinterest-p{color:#cb2027}.fa-pinterest-p:hover{background-color:#cb2027}.fa-tumblr{color:#32506d}.fa-tumblr:hover{background-color:#32506d}.fa-reddit-alien{color:#ff4500}.fa-reddit-alien:hover{background-color:#ff4500}.fa-linkedin{color:#007bb5}.fa-linkedin:hover{background-color:#007bb5}.fa-envelope{color:#444444}.fa-envelope:hover{background-color:#444444}</style></head><body><main role="main"><header role="banner"><h1 class="logo">The Data Guy</h1><div class="page-author h-card p-author"><img src="/assets/circle-cropped.png" class="author-avatar u-photo" alt="Bhuvanesh"></div><nav role="navigation"><ul><li><a href="/" >Home</a></li><li><a href="/posts/" >Posts</a></li><li><a href="/categories/" >Categories</a></li><li><a href="/tags/" >Tags</a></li><li><a href="https://medium.com/@bhuvithedataguy" >Medium Blog</a></li><li><a href="/search" >Search Here</a></li></ul></nav></header><section class="post"><h2>Automation Script For Percona Xtrabackup FULL/Incremental</h2><p><img src="/assets/Automation-Script-For-Percona-Xtrabackup-FULLIncremental.jpg" alt="Automation Script For Percona Xtrabackup FULL/Incremental" /></p><p>Image Source: DigitalOcean</p><p>This is my first post in 2019, and Im starting with a MySQL solution. In MySQL world, implementing a better backup strategy to meet all of your requirement is still a challenging thing. The complexity depends on your RPO and RTO. Percona has many tools to help DBAs in many scenarios. <strong><code class="language-html highlighter-rouge">[Xtrabackup](https://www.percona.com/software/mysql-database/percona-xtrabackup)</code></strong> is one of the best backup tools to perform a better backup on TeraBytes size of databases. Also, another great feature is it supports Incremental and Differential backup.</p><p>There are couple of tools which is available in MySQL world, But due to some restrictions we can’t achieve what we are expecting.</p><h2 id="1mysqldump">#1 <a href="https://dev.mysql.com/doc/refman/8.0/en/mysqldump.html">mysqldump</a></h2><p>This is a widely used backup tool and most of the DBAs are trust this. This comes with the mysql package. Initially, it was a single thread process but now we have multi-thread in native mysqldump. Its completely a logical backup tool. It has a wide range of parameters to use while taking backups (like include routines, events, triggers).</p><p><strong>Right place to use</strong> <code class="language-html highlighter-rouge">mysqldump﻿</code></p><p>Use if your databases are less than 20GB. Because the restore process will take more time. This will affect your RTO.</p><h3 id="advantages">Advantages:</h3><ul><li>Easy to use</li><li>More detailed documentation.</li><li>Multi-Thread (we need to add parameters to perform this)</li><li>Comes with MySQL, so they will fix if any bugs and implementing new features.</li></ul><h3 id="drawbacks">Drawbacks:</h3><ul><li>Backup is multi-thread, but not restore. Its still a single thread process.</li><li>No incremental backup feature.</li><li>Restoration takes more time for large backups.</li></ul><h2 id="2mydumpermyloader">#2 <a href="https://github.com/maxbube/mydumper">mydumper/myloader</a></h2><p>This is an opensource tool and DBAs are using this for dump the huge databases. It has inbuild multi-thread dump and restore feature. This is the pioneer for mysql’s multi thread dump. It supports snapshot consistency. So it’ll provide the accurate binlog file and its position.</p><p><strong>The right place to use</strong> <code class="language-html highlighter-rouge">mydumper/myloader</code></p><p>If you have the databases grater then 20GB to TB/PB. I have used this to dump TB size. If you used this to take dump for a PB size DB using mysqldumper then please comment below.</p><h3 id="advantages-1">Advantages:</h3><ul><li>Multi-thread backup and restore.</li><li>Supports for Incremental backups.</li><li>Log the binlog info, so we can easily built a new slave.</li><li>We can control the number of threads.</li><li>Compression support.</li><li>Include/Exclude tables in backup.</li><li>Split the table into chunks.</li><li>And etc,etc.</li></ul><h3 id="drawbacks-1">Drawbacks:</h3><ul><li>This is also a logical dump. So it needs to scan the complete tables.</li><li>Performance degrade during the backup.</li><li>No checksum.</li></ul><h2 id="3percona-xtrabackup">#3 <a href="https://www.percona.com/software/mysql-database/percona-xtrabackup">Percona Xtrabackup</a>:</h2><p>This is my favourite opensource tool from Percona. This is also supports incremental backup. The main reason is its very fast since its Physical backup. Instead of reading my story just go through this <a href="https://www.percona.com/doc/percona-xtrabackup/LATEST/index.html">Doc link</a> and see its features.</p><p>You can use this to backup &gt;20GB databases to TB or PB.</p><h3 id="advantages-2">Advantages:</h3><ul><li>Multi-thread</li><li>Super fast</li><li>Compression</li><li>Checksum</li><li>Encryption</li><li>Master/Slave binlog info.</li><li>Directly restore the backups to AWS Aurora.</li></ul><h3 id="drawback">Drawback:</h3><ul><li>Not much, I’ll update this section if I found something.</li></ul><h2 id="shell-script-to-automate-xtrabackup">Shell Script to Automate Xtrabackup:</h2><p>Now coming to the automation part. Im using a shell script to automate FULL and Incremental backup also sync them with GCS and S3. This script is already written by <a href="https://www.percona.com/forums/questions-discussions/percona-xtrabackup/10772-[script]-automatic-backups-incremental-full-and-restore">bigzaqui</a> at 2013. But I replaced innobackupex with Xtrabackup and few more changes.</p><h3 id="parameters-needs-to-change">Parameters needs to change:</h3><ul><li><strong><code class="language-html highlighter-rouge">-u sqladmin</code></strong> – Mysql user to take the dump. Replace with <code class="language-html highlighter-rouge">-u your_user</code></li><li><strong><code class="language-html highlighter-rouge">SECRET='mysql-user-password'</code></strong>– Mysql user’s password.</li><li><strong><code class="language-html highlighter-rouge">--history</code></strong>– Im tacking backup activity into a database. If you don’t want to track just remove this.</li><li><strong><code class="language-html highlighter-rouge">--slave-info</code></strong> – If you are taking the backup from a slave, it’ll capture the master’s binloginfo. So you can setup a new replica for the Master Server. You can remove this if you are not using slave to take backup.</li><li><strong><code class="language-html highlighter-rouge">--compress-threads=4,---parallel=4</code></strong> The number of threads needs to perform compress. Its a best practice to allocate 30%-40% from the total cores. I have 40core cpu, so I used 15 threads.</li><li><strong><code class="language-html highlighter-rouge">--remove-original</code></strong> – While decompressing a compressed backup, it’ll leave the compressed files. So this will remove compressed files after the extraction process.</li><li><strong><code class="language-html highlighter-rouge">BACKUP_DIR=/mysqldump/xtrabackup/</code></strong> – Location for saving the dump.</li><li><strong><code class="language-html highlighter-rouge">DATA_DIR=/mysqldata</code></strong> – Location of mysql data directory. If you added <strong><code class="language-html highlighter-rouge">[xtrabackup]</code></strong> parameters in <strong><code class="language-html highlighter-rouge">my.cnf</code></strong> file, then no need to mention this.</li></ul><script src="https://gist.github.com/SQLadmin/e9706736186fab3135822c291eee99c6.js"></script><h2 id="run-this-script">Run this script:</h2><ul><li><strong>FULL Backup</strong> – <code class="language-html highlighter-rouge">./xtrabackup_full_increment_restore.sh full</code></li><li><strong>Incremental Backup</strong> – <code class="language-html highlighter-rouge">./xtrabackup_full_increment_restore.sh incremental</code></li><li><strong>Restore</strong> – <code class="language-html highlighter-rouge">./xtrabackup_full_increment_restore.sh restore</code></li></ul><span class="meta"><time datetime="2019-01-01T15:33:18+00:00">January 1, 2019</time> &middot; <a href="/tags/#backup">backup</a>, <a href="/tags/#mysql">mysql</a>, <a href="/tags/#recovery">recovery</a>, <a href="/tags/#restore">restore</a>, <a href="/tags/#xtrabackup">xtrabackup</a>, <a href="/tags/#Backup and Recovery">Backup and Recovery</a></span><hr> <!--<span class="meta"><time datetime="2019-01-01T15:33:18+00:00">January 1, 2019</time> &middot; <a class="post" href="/tag/backup">backup</a>, <a class="post" href="/tag/mysql">mysql</a>, <a class="post" href="/tag/recovery">recovery</a>, <a class="post" href="/tag/restore">restore</a>, <a class="post" href="/tag/xtrabackup">xtrabackup</a>, <a class="post" href="/tag/Backup and Recovery">Backup and Recovery</a></span> --></section></main></body></html>
