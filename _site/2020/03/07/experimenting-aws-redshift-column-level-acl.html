<!DOCTYPE html><html lang="en" ><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="/assets/css/syntax.css" rel="stylesheet"><title>Experimenting AWS RedShift Column Level ACL | The Data Guy</title><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="Experimenting AWS RedShift Column Level ACL" /><meta name="author" content="Bhuvanesh" /><meta property="og:locale" content="en_US" /><meta name="description" content="Test and explore all the fuctions of RedShift column level acces control" /><meta property="og:description" content="Test and explore all the fuctions of RedShift column level acces control" /><meta property="og:site_name" content="The Data Guy" /><meta property="og:image" content="/assets/Experimenting%20AWS%20RedShift%20Column%20Level%20ACL.jpg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-03-07T11:50:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:image" content="/assets/Experimenting%20AWS%20RedShift%20Column%20Level%20ACL.jpg" /><meta property="twitter:title" content="Experimenting AWS RedShift Column Level ACL" /><meta name="twitter:site" content="@bhuvithedataguy" /><meta name="twitter:creator" content="@https://twitter.com/BhuviTheDataGuy" /> <script type="application/ld+json"> {"dateModified":"2020-03-07T11:50:00+00:00","datePublished":"2020-03-07T11:50:00+00:00","image":"/assets/Experimenting%20AWS%20RedShift%20Column%20Level%20ACL.jpg","url":"/2020/03/07/experimenting-aws-redshift-column-level-acl","mainEntityOfPage":{"@type":"WebPage","@id":"/2020/03/07/experimenting-aws-redshift-column-level-acl"},"@type":"BlogPosting","author":{"@type":"Person","name":"Bhuvanesh"},"description":"Test and explore all the fuctions of RedShift column level acces control","headline":"Experimenting AWS RedShift Column Level ACL","@context":"https://schema.org"}</script><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.7;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#ecedee}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}#share-bar{font-size:20px}#share-bar h4{margin-bottom:10px;font-weight:500}.share-button{margin:0px;margin-bottom:10px;margin-right:3px;border:1px solid #D3D6D2;padding:5px 10px 5px 10px}.share-button:hover{opacity:1;color:#ffffff}.fa-facebook-official{color:#3b5998}.fa-facebook-official:hover{background-color:#3b5998}.fa-twitter{color:#55acee}.fa-twitter:hover{background-color:#55acee}.fa-google-plus{color:#dd4b39}.fa-google-plus:hover{background-color:#dd4b39}.fa-pinterest-p{color:#cb2027}.fa-pinterest-p:hover{background-color:#cb2027}.fa-tumblr{color:#32506d}.fa-tumblr:hover{background-color:#32506d}.fa-reddit-alien{color:#ff4500}.fa-reddit-alien:hover{background-color:#ff4500}.fa-linkedin{color:#007bb5}.fa-linkedin:hover{background-color:#007bb5}.fa-envelope{color:#444444}.fa-envelope:hover{background-color:#444444}</style></head><body><main role="main"><header role="banner"><h1 class="logo">The Data Guy</h1><div class="page-author h-card p-author"><img src="/assets/circle-cropped.png" class="author-avatar u-photo" alt="Bhuvanesh"></div><nav role="navigation"><ul><li><a href="/" >Home</a></li><li><a href="/posts/" >Posts</a></li><li><a href="/categories/" >Categories</a></li><li><a href="/tags/" >Tags</a></li><li><a href="https://medium.com/@bhuvithedataguy" >Medium Blog</a></li><li><a href="/search" >Search Here</a></li></ul></nav></header><section class="post"><h2>Experimenting AWS RedShift Column Level ACL</h2><p>Good news for the RedShift customers now we can <code class="language-html highlighter-rouge">GRANT</code> column-level permissions on the tables. It’s not only limited to tables, but we can also grant on views and materialized views as well. When the Lake formation was announced, this feature was a part of it. But unfortunately, we need to use Redshift Spectrum to achieve this. The wait is over now. Redshift natively supports the column level restrictions. Im experimenting and walk through this feature and test all the statements mentioned in the Redshift documentation.</p><h2 id="import-a-sample-table">Import a sample table:</h2><p>For our experiment, we need sample data. So I have download a <code class="language-html highlighter-rouge">.csv</code> file from <a href="https://mockaroo.com/">mockaroo</a> and then uploaded the CSV file into my S3 bucket.</p><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="n">test_data</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">first_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
    <span class="n">last_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
    <span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
    <span class="n">gender</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
    <span class="n">ip_address</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">COPY</span> <span class="n">test_data</span>  <span class="k">from</span> <span class="s1">'s3://my-data-lake/mock_data.csv'</span> <span class="n">iam_role</span> <span class="s1">'arn:aws:iam::1111111111:role/Copying-S3to-RS'</span> <span class="n">CSV</span><span class="p">;</span></code></pre></figure><p>I have executed the copy command for multiple times to make my table as some decent amount of rows.</p><h2 id="notes-about-column-level-acl">Notes about column level ACL:</h2><ul><li>You can control the column level access only for <code class="language-html highlighter-rouge">SELECT</code> and <code class="language-html highlighter-rouge">UPDATE</code>.</li><li>Once you assigned some column level restriction, then that user should specifically mention the column names in the query. <code class="language-html highlighter-rouge">Select *</code> will not work.</li><li>You can control the table, view and materialized views.</li><li>If you want to give both select and update to a user, then just use <code class="language-html highlighter-rouge">GRANT ALL (column names)</code> will give both access to those columns.</li><li>Table Owner and Superusers can grant the column ACL.</li></ul><h2 id="experiments">Experiments:</h2><p>Before we start our experiment, we can create a user for this.</p><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">create</span> <span class="k">user</span> <span class="n">rs_expriment</span> <span class="n">password</span> <span class="s1">'Mypass123'</span><span class="p">;</span></code></pre></figure><h3 id="1-grant-select-only-access">#1 Grant select only access:</h3><p>Let’s grant select access for a few columns and see how the user can access it in different ways.</p><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">grant</span> <span class="k">select</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">)</span> <span class="k">on</span> <span class="n">test_data</span> <span class="k">to</span> <span class="n">rs_expriment</span><span class="p">;</span>

<span class="k">set</span> <span class="k">session</span> <span class="k">authorization</span> <span class="n">rs_expriment</span><span class="p">;</span>
<span class="k">SET</span>

<span class="k">select</span> <span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span> <span class="k">from</span> <span class="n">test_data</span> <span class="k">limit</span> <span class="mi">10</span><span class="p">;</span>
 <span class="n">id</span> <span class="o">|</span> <span class="n">first_name</span> <span class="o">|</span> <span class="n">last_name</span>
<span class="c1">----+------------+-----------</span>
  <span class="mi">1</span> <span class="o">|</span> <span class="n">Bernie</span>     <span class="o">|</span> <span class="n">Hull</span>
  <span class="mi">3</span> <span class="o">|</span> <span class="n">Carmina</span>    <span class="o">|</span> <span class="n">Cahill</span>
  <span class="mi">5</span> <span class="o">|</span> <span class="n">Leanora</span>    <span class="o">|</span> <span class="n">Boribal</span>
  <span class="mi">7</span> <span class="o">|</span> <span class="n">Eal</span>        <span class="o">|</span> <span class="n">Crocetto</span>
  <span class="mi">9</span> <span class="o">|</span> <span class="n">Gaylor</span>     <span class="o">|</span> <span class="n">Dugmore</span>
 <span class="mi">11</span> <span class="o">|</span> <span class="n">Pren</span>       <span class="o">|</span> <span class="n">Stenhouse</span>
 <span class="mi">13</span> <span class="o">|</span> <span class="n">Jonie</span>      <span class="o">|</span> <span class="n">Sloegrave</span>
 <span class="mi">15</span> <span class="o">|</span> <span class="n">Heinrik</span>    <span class="o">|</span> <span class="n">Cremen</span>
 <span class="mi">17</span> <span class="o">|</span> <span class="n">Lauri</span>      <span class="o">|</span> <span class="n">Fraser</span>
 <span class="mi">19</span> <span class="o">|</span> <span class="n">Nicolina</span>   <span class="o">|</span> <span class="n">Edwards</span></code></pre></figure><p>Lets query other column and all columns.</p><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">select</span> <span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span> <span class="k">from</span> <span class="n">test_data</span> <span class="k">limit</span> <span class="mi">10</span><span class="p">;</span>
<span class="n">ERROR</span><span class="p">:</span>  <span class="n">permission</span> <span class="n">denied</span> <span class="k">for</span> <span class="n">relation</span> <span class="n">test_data</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">test_data</span> <span class="k">limit</span> <span class="mi">10</span><span class="p">;</span>
<span class="n">ERROR</span><span class="p">:</span>  <span class="n">permission</span> <span class="n">denied</span> <span class="k">for</span> <span class="n">relation</span> <span class="n">test_data</span></code></pre></figure><h3 id="2-grant-update-access">#2 Grant UPDATE access</h3><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">grant</span> <span class="k">update</span> <span class="p">(</span><span class="n">first_name</span><span class="p">)</span> <span class="k">on</span> <span class="n">test_data</span> <span class="k">to</span> <span class="n">rs_expriment</span><span class="p">;</span>
<span class="k">GRANT</span>

<span class="k">set</span> <span class="k">session</span> <span class="k">authorization</span> <span class="n">rs_expriment</span><span class="p">;</span>
<span class="k">SET</span>

<span class="k">update</span> <span class="n">test_data</span> <span class="k">set</span> <span class="n">first_name</span><span class="o">=</span><span class="s1">'test_name'</span>  <span class="k">where</span> <span class="n">first_name</span><span class="o">=</span><span class="s1">'Bernie'</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="mi">13</span></code></pre></figure><p>Now test with other columns.</p><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">update</span> <span class="n">test_data</span> <span class="k">set</span> <span class="n">last_name</span><span class="o">=</span><span class="s1">'test_name'</span>  <span class="k">where</span> <span class="n">first_name</span><span class="o">=</span><span class="s1">'Bernie'</span><span class="p">;</span>
<span class="n">ERROR</span><span class="p">:</span>  <span class="n">permission</span> <span class="n">denied</span> <span class="k">for</span> <span class="n">relation</span> <span class="n">test_data</span>

<span class="k">delete</span> <span class="k">from</span> <span class="n">test_data</span> <span class="k">where</span> <span class="n">first_name</span><span class="o">=</span><span class="s1">'test_name'</span><span class="p">;</span>
<span class="n">ERROR</span><span class="p">:</span>  <span class="n">permission</span> <span class="n">denied</span> <span class="k">for</span> <span class="n">relation</span> <span class="n">test_data</span></code></pre></figure><h3 id="3-select--update-togehter">#3 select + update togehter</h3><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">update</span> <span class="n">test_data</span> <span class="k">set</span> <span class="n">first_name</span><span class="o">=</span><span class="n">last_name</span>  <span class="k">where</span> <span class="n">first_name</span><span class="o">=</span><span class="s1">'test_name'</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="mi">13</span>

<span class="k">update</span> <span class="n">test_data</span> <span class="k">set</span> <span class="n">first_name</span><span class="o">=</span><span class="n">email</span>  <span class="k">where</span> <span class="n">first_name</span><span class="o">=</span><span class="s1">'test_name'</span><span class="p">;</span>
<span class="n">ERROR</span><span class="p">:</span>  <span class="n">permission</span> <span class="n">denied</span> <span class="k">for</span> <span class="n">relation</span> <span class="n">test_data</span></code></pre></figure><h3 id="4-test-the-statements-from-the-redshift-doc">#4 Test the statements from the RedShift Doc</h3><blockquote><p>If a user has a table-level privilege on a table, then granting the same privilege at the column level has no effect.</p></blockquote><p>Anyhow this clearly explains the logic. So we can skip this.</p><blockquote><p>If a user has a table-level privilege on a table, then revoking the same privilege for one or more columns of the table returns an error. Instead, revoke the privilege at the table level.</p></blockquote><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">create</span> <span class="k">user</span> <span class="n">table_full_select</span> <span class="n">password</span> <span class="s1">'MyPass123'</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">USER</span>

<span class="k">grant</span> <span class="k">select</span> <span class="k">on</span> <span class="n">test_data</span> <span class="k">to</span> <span class="n">table_full_select</span><span class="p">;</span>
<span class="k">GRANT</span>

<span class="k">revoke</span> <span class="k">select</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">first_name</span><span class="p">)</span> <span class="k">on</span> <span class="n">test_data</span> <span class="k">from</span> <span class="n">table_full_select</span><span class="p">;</span>

<span class="n">ERROR</span><span class="p">:</span>  <span class="n">Cannot</span> <span class="k">revoke</span> <span class="k">SELECT</span> <span class="n">privilege</span> <span class="k">on</span> <span class="n">test_data</span><span class="p">.</span><span class="n">id</span> <span class="k">from</span> <span class="k">user</span> <span class="n">table_full_select</span> <span class="k">as</span> <span class="n">the</span> <span class="n">grantee</span> <span class="n">holds</span> <span class="n">this</span> <span class="n">privilege</span> <span class="k">at</span> <span class="n">the</span> <span class="n">relation</span> <span class="k">level</span><span class="p">.</span> <span class="k">Revoke</span> <span class="n">the</span> <span class="n">relation</span> <span class="k">level</span> <span class="n">privilege</span> <span class="k">instead</span><span class="p">.</span></code></pre></figure><blockquote><p>If a user has a column-level privilege, then granting the same privilege at the table level returns an error.</p></blockquote><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">create</span> <span class="k">user</span> <span class="n">column_select</span> <span class="n">password</span> <span class="s1">'MyPass123'</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">USER</span>

<span class="k">grant</span> <span class="k">select</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">first_name</span><span class="p">)</span> <span class="k">on</span> <span class="n">test_data</span> <span class="k">to</span> <span class="n">column_select</span><span class="p">;</span>
<span class="k">GRANT</span>

<span class="k">grant</span> <span class="k">select</span> <span class="k">on</span> <span class="n">test_data</span> <span class="k">to</span> <span class="n">column_select</span><span class="p">;</span>
<span class="n">ERROR</span><span class="p">:</span>  <span class="k">No</span> <span class="k">privileges</span> <span class="n">were</span> <span class="k">granted</span><span class="p">.</span> <span class="k">Some</span> <span class="n">grantees</span> <span class="k">hold</span> <span class="k">column</span> <span class="k">privileges</span> <span class="k">on</span> <span class="n">relation</span> <span class="n">test_data</span><span class="p">.</span> <span class="k">Check</span> <span class="k">for</span> <span class="k">and</span> <span class="k">revoke</span> <span class="k">column</span> <span class="k">level</span> <span class="k">privileges</span> <span class="k">for</span> <span class="n">these</span> <span class="n">grantees</span> <span class="k">on</span> <span class="k">all</span> <span class="n">relations</span> <span class="n">referenced</span> <span class="k">in</span> <span class="n">this</span> <span class="k">Grant</span> <span class="k">statement</span> <span class="k">before</span> <span class="n">granting</span> <span class="k">table</span> <span class="k">privileges</span> <span class="k">to</span> <span class="n">them</span><span class="p">.</span></code></pre></figure><blockquote><p>If a user has a column-level privilege, then revoking the same privilege at the table level revokes both column and table privileges for all columns on the table.</p></blockquote><p>Note: If you want to revoke the select/update from a column level privilege user, then if you use just <code class="language-html highlighter-rouge">revoke select on</code> or <code class="language-html highlighter-rouge">revoke update on</code> will revoke the access. You can use this syntax for revoking access on table level/column level privilege users.</p><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">create</span> <span class="k">user</span> <span class="n">column_select</span> <span class="n">password</span> <span class="s1">'MyPass123'</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">USER</span>

<span class="k">grant</span> <span class="k">select</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">first_name</span><span class="p">)</span> <span class="k">on</span> <span class="n">test_data</span> <span class="k">to</span> <span class="n">column_select</span><span class="p">;</span>
<span class="k">GRANT</span>

<span class="k">revoke</span> <span class="k">select</span> <span class="k">on</span> <span class="k">table</span> <span class="n">test_data</span> <span class="k">from</span> <span class="n">column_select</span><span class="p">;</span>
<span class="k">REVOKE</span></code></pre></figure><blockquote><p>You can’t grant column-level privileges on late-binding views.</p></blockquote><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">create</span> <span class="k">view</span> <span class="n">v_test_data</span> <span class="k">as</span> <span class="p">(</span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">public</span><span class="p">.</span><span class="n">test_data</span><span class="p">)</span><span class="k">WITH</span> <span class="k">NO</span> <span class="k">SCHEMA</span> <span class="n">BINDING</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">VIEW</span></code></pre></figure><p>Try the grant table level access:</p><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">grant</span> <span class="k">select</span> <span class="k">on</span> <span class="n">v_test_data</span> <span class="k">to</span> <span class="n">column_select</span><span class="p">;</span>
<span class="k">GRANT</span></code></pre></figure><p>Try the same on late-binding view:</p><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">grant</span> <span class="k">select</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">first_name</span><span class="p">)</span> <span class="k">on</span> <span class="n">v_test_data</span> <span class="k">to</span> <span class="n">column_select</span><span class="p">;</span>
<span class="n">ERROR</span><span class="p">:</span>  <span class="k">column</span> <span class="nv">"id"</span> <span class="k">of</span> <span class="n">relation</span> <span class="nv">"v_test_data"</span> <span class="n">does</span> <span class="k">not</span> <span class="n">exist</span><span class="p">.</span></code></pre></figure><blockquote><p>You must have table-level SELECT privilege on the base tables to create a materialized view. Even if you have column-level privileges on specific columns, you can’t create a materialized view on only those columns.</p></blockquote><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">create</span> <span class="k">user</span> <span class="n">mv_user</span> <span class="n">password</span> <span class="s1">'MyPass123'</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">USER</span>

<span class="k">grant</span> <span class="k">select</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">first_name</span><span class="p">)</span> <span class="k">on</span> <span class="n">test_data</span> <span class="k">to</span> <span class="n">mv_user</span><span class="p">;</span>
<span class="k">GRANT</span>

<span class="k">create</span> <span class="k">schema</span> <span class="n">acl</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">SCHEMA</span>

<span class="k">grant</span> <span class="k">all</span> <span class="k">on</span> <span class="k">schema</span> <span class="n">acl</span> <span class="k">to</span> <span class="n">mv_user</span><span class="p">;</span>
<span class="k">GRANT</span>

<span class="k">set</span> <span class="k">session</span> <span class="k">authorization</span> <span class="n">mv_user</span><span class="p">;</span>
<span class="k">SET</span>

<span class="k">CREATE</span> <span class="n">MATERIALIZED</span> <span class="k">VIEW</span> <span class="n">acl</span><span class="p">.</span><span class="n">mv_testdata</span> <span class="k">as</span> <span class="p">(</span><span class="k">select</span> <span class="n">id</span><span class="p">,</span> <span class="n">first_name</span> <span class="k">from</span> <span class="k">public</span><span class="p">.</span><span class="n">test_data</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="n">MATERIALIZED</span> <span class="k">VIEW</span>

<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">acl</span><span class="p">.</span><span class="n">mv_testdata</span> <span class="k">limit</span> <span class="mi">2</span><span class="p">;</span>
<span class="n">ERROR</span><span class="p">:</span>  <span class="n">permission</span> <span class="n">denied</span> <span class="k">for</span> <span class="n">materialized</span> <span class="k">view</span> <span class="n">base</span> <span class="n">relation</span> <span class="n">test_data</span><span class="p">.</span></code></pre></figure><h3 id="oh-ho-what-is-this">oh ho!!! What is this?</h3><p>Because by default you have full access on public schema for all the users. Thats why its created.</p><h3 id="update">Update:</h3><p>Thanks AWS Support team for clarifying this. Lets see what happen if have your base table on the different schema?</p><figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">create</span> <span class="k">schema</span> <span class="n">bhuvi</span><span class="p">;</span>
<span class="k">CREATE</span>

<span class="k">create</span> <span class="k">table</span> <span class="n">bhuvi</span><span class="p">.</span><span class="n">test_data</span> <span class="p">(</span>
	<span class="n">id</span> <span class="nb">INT</span><span class="p">,</span>
	<span class="n">first_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
	<span class="n">last_name</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
	<span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
	<span class="n">gender</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span>
	<span class="n">ip_address</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">bhuvi</span><span class="p">.</span><span class="n">test_data</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'Arden'</span><span class="p">,</span> <span class="s1">'Connichie'</span><span class="p">,</span> <span class="s1">'aconnichie0@nifty.com'</span><span class="p">,</span> <span class="s1">'Female'</span><span class="p">,</span> <span class="s1">'66.179.130.47'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">bhuvi</span><span class="p">.</span><span class="n">test_data</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'Elsie'</span><span class="p">,</span> <span class="s1">'Fryatt'</span><span class="p">,</span> <span class="s1">'efryatt1@jugem.jp'</span><span class="p">,</span> <span class="s1">'Female'</span><span class="p">,</span> <span class="s1">'91.228.196.151'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">bhuvi</span><span class="p">.</span><span class="n">test_data</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'Corette'</span><span class="p">,</span> <span class="s1">'Tomasz'</span><span class="p">,</span> <span class="s1">'ctomasz2@miitbeian.gov.cn'</span><span class="p">,</span> <span class="s1">'Female'</span><span class="p">,</span> <span class="s1">'134.169.27.141'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">bhuvi</span><span class="p">.</span><span class="n">test_data</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">'Margarita'</span><span class="p">,</span> <span class="s1">'Moulden'</span><span class="p">,</span> <span class="s1">'mmoulden3@google.com'</span><span class="p">,</span> <span class="s1">'Female'</span><span class="p">,</span> <span class="s1">'248.63.226.96'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">bhuvi</span><span class="p">.</span><span class="n">test_data</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">'Eran'</span><span class="p">,</span> <span class="s1">'McCoveney'</span><span class="p">,</span> <span class="s1">'emccoveney4@redcross.org'</span><span class="p">,</span> <span class="s1">'Female'</span><span class="p">,</span> <span class="s1">'19.137.118.110'</span><span class="p">);</span>

<span class="k">grant</span> <span class="k">select</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">first_name</span><span class="p">)</span> <span class="k">on</span> <span class="n">bhuvi</span><span class="p">.</span><span class="n">test_data</span> <span class="k">to</span> <span class="n">mv_user</span><span class="p">;</span>
<span class="k">GRANT</span>

<span class="k">set</span> <span class="k">session</span> <span class="k">authorization</span> <span class="n">mv_user</span><span class="p">;</span>
<span class="k">SET</span>

<span class="k">CREATE</span> <span class="n">MATERIALIZED</span> <span class="k">VIEW</span> <span class="n">bhuvi</span><span class="p">.</span><span class="n">mv_testdata</span> <span class="k">as</span> <span class="p">(</span><span class="k">select</span> <span class="n">id</span><span class="p">,</span> <span class="n">first_name</span> <span class="k">from</span> <span class="n">bhuvi</span><span class="p">.</span><span class="n">test_data</span><span class="p">);</span>
<span class="n">ERROR</span><span class="p">:</span>  <span class="n">permission</span> <span class="n">denied</span> <span class="k">for</span> <span class="k">schema</span> <span class="n">bhuvi</span></code></pre></figure><h2 id="conclusion">Conclusion:</h2><p>Its not a big deal to work with column level ACL. But its worth to test every small feature. So you have better visibility about the feature and find the bugs like what we found above. I’ll update this blog once the AWS team confirms this as a bug or not.</p><span class="meta"><time datetime="2020-03-07T11:50:00+00:00">March 7, 2020</time> &middot; <a href="/tags/#aws">aws</a>, <a href="/tags/#redshift">redshift</a>, <a href="/tags/#security">security</a></span><hr> <!--<span class="meta"><time datetime="2020-03-07T11:50:00+00:00">March 7, 2020</time> &middot; <a class="post" href="/tag/aws">aws</a>, <a class="post" href="/tag/redshift">redshift</a>, <a class="post" href="/tag/security">security</a></span> --></section></main></body></html>
