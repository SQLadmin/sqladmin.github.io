<!DOCTYPE html><html lang="en" ><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="/assets/css/syntax.css" rel="stylesheet"><title>Postgresql Insecure directory in ENV PATH - Unable To Start | The Data Guy</title><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="Postgresql Insecure directory in ENV PATH - Unable To Start" /><meta name="author" content="Bhuvanesh" /><meta property="og:locale" content="en_US" /><meta name="description" content="Unable to start postgresql in ubuntu. The error in postgrsql Insecure directory in env path. In syslog Insecure directory in $ENV{PATH}." /><meta property="og:description" content="Unable to start postgresql in ubuntu. The error in postgrsql Insecure directory in env path. In syslog Insecure directory in $ENV{PATH}." /><meta property="og:site_name" content="The Data Guy" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-12-05T12:42:07+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Postgresql Insecure directory in ENV PATH - Unable To Start" /><meta name="twitter:site" content="@bhuvithedataguy" /><meta name="twitter:creator" content="@https://twitter.com/BhuviTheDataGuy" /> <script type="application/ld+json"> {"dateModified":"2017-12-05T12:42:07+00:00","datePublished":"2017-12-05T12:42:07+00:00","url":"/2017/12/05/postgrsql-insecure-directory-in-env-path","mainEntityOfPage":{"@type":"WebPage","@id":"/2017/12/05/postgrsql-insecure-directory-in-env-path"},"@type":"BlogPosting","author":{"@type":"Person","name":"Bhuvanesh"},"description":"Unable to start postgresql in ubuntu. The error in postgrsql Insecure directory in env path. In syslog Insecure directory in $ENV{PATH}.","headline":"Postgresql Insecure directory in ENV PATH - Unable To Start","@context":"https://schema.org"}</script><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui, sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.7;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#ecedee}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:0.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:0.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}#share-bar{font-size:20px}#share-bar h4{margin-bottom:10px;font-weight:500}.share-button{margin:0px;margin-bottom:10px;margin-right:3px;border:1px solid #D3D6D2;padding:5px 10px 5px 10px}.share-button:hover{opacity:1;color:#ffffff}.fa-facebook-official{color:#3b5998}.fa-facebook-official:hover{background-color:#3b5998}.fa-twitter{color:#55acee}.fa-twitter:hover{background-color:#55acee}.fa-google-plus{color:#dd4b39}.fa-google-plus:hover{background-color:#dd4b39}.fa-pinterest-p{color:#cb2027}.fa-pinterest-p:hover{background-color:#cb2027}.fa-tumblr{color:#32506d}.fa-tumblr:hover{background-color:#32506d}.fa-reddit-alien{color:#ff4500}.fa-reddit-alien:hover{background-color:#ff4500}.fa-linkedin{color:#007bb5}.fa-linkedin:hover{background-color:#007bb5}.fa-envelope{color:#444444}.fa-envelope:hover{background-color:#444444}</style></head><body><main role="main"><header role="banner"><h1 class="logo">The Data Guy</h1><div class="page-author h-card p-author"><img src="/assets/circle-cropped.png" class="author-avatar u-photo" alt="Bhuvanesh"></div><nav role="navigation"><ul><li><a href="/" >Home</a></li><li><a href="/posts/" >Posts</a></li><li><a href="/categories/" >Categories</a></li><li><a href="/tags/" >Tags</a></li><li><a href="https://medium.com/@bhuvithedataguy" >Medium Blog</a></li><li><a href="/search" >Search Here</a></li></ul></nav></header><section class="post"><h2>Postgresql Insecure directory in ENV PATH - Unable To Start</h2><p><img src="/assets/Postgresql-Unable-To-Start-Insecure-directory-in-ENV-PATH.jpg" alt="Postgrsql Insecure directory in env path" /></p><blockquote><p>Insecure directory in $ENV{PATH}</p></blockquote><p>I was discussing with one of my friend who is a Developer, as he was working with PostgreSQL 9.5 in Ubuntu 16.04LTS from past few months. But suddenly he couldn’t able to start PostgreSQL service. He tried to reinstall PostgreSQL many times, but no luck. So he gave his laptop to me and asked to fix this issue.(Because of Im a DBA). The very first thing I started to look at the Postgresql logs. Unfortunately, nothing was there. So I checked the syslog file and found something wrong. It was showing the error in <strong>Postgrsql Insecure directory in env path</strong>.</p><h2 id="here-is-the-complete-error-log">Here is the complete error log:</h2><figure class="highlight"><pre><code class="language-shell" data-lang="shell">Dec 5  17:21:17 k7-ThinkPad systemd[1]: Starting PostgreSQL Cluster 9.5-main...
Dec 5  17:21:17 k7-ThinkPad postgresql@9.5-main[5682]: Insecure directory <span class="k">in</span> <span class="nv">$ENV</span><span class="o">{</span>PATH<span class="o">}</span> <span class="k">while </span>running with <span class="nt">-T</span> switch at /usr/bin/pg_ctlcluster line 469.
Dec 5  17:21:17 k7-ThinkPad systemd[1]: postgresql@9.5-main.service: Control process exited, <span class="nv">code</span><span class="o">=</span>exited <span class="nv">status</span><span class="o">=</span>2
Dec 5  17:21:17 k7-ThinkPad systemd[1]: Failed to start PostgreSQL Cluster 9.5-main.
Dec 5  17:21:17 k7-ThinkPad systemd[1]: postgresql@9.5-main.service: Unit entered failed state.
Dec 5  17:21:17 k7-ThinkPad systemd[1]: postgresql@9.5-main.service: Failed with result <span class="s1">'exit-code'</span><span class="nb">.</span>
Dec 5  17:21:17 k7-ThinkPad systemd[1]: Started PostgreSQL RDBMS.</code></pre></figure><p>From these errors, we can guess something wrong with the /usr/bin/pg_ctlcluster file and the line 469.</p><h2 id="here-is-the-line">Here is the line:</h2><figure class="highlight"><pre><code class="language-shell" data-lang="shell">466  <span class="c"># recreate stats_temp_directory</span>
467  <span class="k">if</span>  <span class="o">(</span><span class="nv">$action</span> ne <span class="s1">'stop'</span> <span class="o">&amp;&amp;</span> <span class="nv">$info</span><span class="o">{</span>config<span class="o">}</span>-&gt;<span class="o">{</span>stats_temp_directory<span class="o">}</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nt">-d</span> <span class="nv">$info</span><span class="o">{</span>config<span class="o">}</span>-&gt;<span class="o">{</span>stats_temp_directory<span class="o">})</span>  <span class="o">{</span>
468 system <span class="s1">'install'</span>, <span class="s1">'-d'</span>, <span class="s1">'-m'</span>, 750,
469  <span class="s1">'-o'</span>, <span class="nv">$info</span><span class="o">{</span><span class="s1">'owneruid'</span><span class="o">}</span>, <span class="s1">'-g'</span>, <span class="nv">$info</span><span class="o">{</span><span class="s1">'ownergid'</span><span class="o">}</span>, <span class="nv">$info</span><span class="o">{</span>config<span class="o">}</span>-&gt;<span class="o">{</span>stats_temp_directory<span class="o">}</span><span class="p">;</span>
470  <span class="o">}</span></code></pre></figure><p>Seems its fine. Then what caused this issue?<br /> Look at the line number 468.</p><figure class="highlight"><pre><code class="language-shell" data-lang="shell">system <span class="s1">'install'</span>, <span class="s1">'-d'</span>, <span class="s1">'-m'</span>, 750,</code></pre></figure><p>The 750 is nothing its the permission for the ENV PATH.</p><h2 id="here-is-the-env-path-in-this-file">Here is the ENV PATH in this file.</h2><figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># untaint environment</span>
<span class="nv">$ENV</span><span class="o">{</span><span class="s1">'PATH'</span><span class="o">}</span> <span class="o">=</span> <span class="s1">'/sbin:/bin:/usr/sbin:/usr/bin'</span><span class="p">;</span>
delete @ENV<span class="o">{</span><span class="s1">'IFS'</span>, <span class="s1">'CDPATH'</span>, <span class="s1">'ENV'</span>, <span class="s1">'BASH_ENV'</span><span class="o">}</span><span class="p">;</span>
chdir <span class="s1">'/'</span><span class="p">;</span></code></pre></figure><h2 id="solution">Solution:</h2><p>Change the permission for the <strong>/bin</strong> directory.</p><figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="nb">chmod </span>750 /bin
service postgresql start
su postgres
psql</code></pre></figure><p><img src="/assets/Postgrsql-Insecure-directory-in-env-path-Result.png" alt="Postgrsql Insecure directory in env path - Result" /></p><span class="meta"><time datetime="2017-12-05T12:42:07+00:00">December 5, 2017</time> &middot; <a href="/tags/#linux">linux</a>, <a href="/tags/#postgresql">postgresql</a>, <a href="/tags/#ubuntu">ubuntu</a></span><hr> <!--<span class="meta"><time datetime="2017-12-05T12:42:07+00:00">December 5, 2017</time> &middot; <a class="post" href="/tag/linux">linux</a>, <a class="post" href="/tag/postgresql">postgresql</a>, <a class="post" href="/tag/ubuntu">ubuntu</a></span> --></section></main></body></html>
